<!DOCTYPE html>

<html lang="en">

<head>
  <meta charset="utf-8" />
  <meta content="width=device-width, initial-scale=1.0" name="viewport" />
  <title>Palette: Robert Brown</title>
  <script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;900&amp;display=swap"
    rel="stylesheet" />
  <link
    href="https://fonts.googleapis.com/css2?family=Playfair+Display:ital,wght@0,400..900;1,400..900&amp;display=swap"
    rel="stylesheet" />
  <link
    href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:wght,FILL@100..700,0..1&amp;display=swap"
    rel="stylesheet" />
  <link
    href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:wght,FILL@100..700,0..1&amp;display=swap"
    rel="stylesheet" />
  <script id="tailwind-config">
    tailwind.config = {
      darkMode: "class",
      theme: {
        extend: {
          colors: {
            "primary": "#a5745b",
            "background-light": "#f6f6f8",
            "background-dark": "#101622",
          },
          fontFamily: {
            "display": ["Inter", "sans-serif"],
            "serif": ["Playfair Display", "serif"]
          },
          borderRadius: {
            "DEFAULT": "0.25rem",
            "lg": "0.5rem",
            "xl": "0.75rem",
            "full": "9999px"
          },
        },
      },
    }
  </script>
  <style>
    .material-symbols-outlined {
      font-variation-settings: 'FILL' 0, 'wght' 400, 'GRAD' 0, 'opsz' 24;
    }

    .swatch-card:hover .copy-overlay,
    .swatch-card:focus-within .copy-overlay {
      opacity: 1;
    }

    .swatch-live-label {
      opacity: 0;
      width: 90%;
      border-radius: 20px;
      margin-top: 8px;
      margin-left: auto;
      margin-right: auto;
      transform: translateY(-8px);
      transition: opacity 200ms ease, transform 200ms ease;
      -webkit-backdrop-filter: blur(12px);
      backdrop-filter: blur(12px);
      background: rgba(17, 24, 39, 0.25);
      pointer-events: none;
    }

    .swatch-live-label.is-visible {
      opacity: 1;
      transform: translateY(0);
    }

    .swatch-secondary-chips-container {
      opacity: 0;
      transition: opacity 150ms ease;
      pointer-events: none;
    }

    .swatch-primary:hover .swatch-secondary-chips-container,
    .swatch-primary:focus-within .swatch-secondary-chips-container {
      opacity: 1;
      pointer-events: auto;
    }

    .swatch-secondary-chip {
      width: 32px;
      height: 32px;
      border-radius: 9999px;
      transition: transform 150ms ease, box-shadow 150ms ease;
    }

    .swatch-secondary-chip:hover,
    .swatch-secondary-chip:focus-visible {
      transform: scale(1.08);
      border: 1.5px solid rgba(255, 255, 255, 0.82);
      box-shadow: 0 0 0 2px rgba(255, 255, 255, 0.9);
    }
  </style>
</head>

<body class="bg-background-light dark:bg-background-dark font-display text-[#0d121b] transition-colors duration-300">
  <div class="relative flex min-h-screen w-full flex-col overflow-x-hidden">
    <div class="layout-container flex h-full grow flex-col">
      <!-- Navigation Header -->

      <main class="flex-1 px-6 md:px-20 lg:px-40 py-12">
        <!-- Hero Section -->
        <div class="max-w-4xl mb-12">
          <h1 class="text-[#0d121b] dark:text-white text-5xl leading-tight tracking-tight mb-2 font-serif font-bold">
            Color Palette
          </h1>
          <p class="text-[#0d121b] dark:text-white text-lg max-w-2xl"><span class="font-serif italic text-xl">Robert Brown Fabric
              Collection</span>
          </p>
        </div>
        <!-- Search -->
        <div class="relative mb-8" id="search-container">
          <div class="relative">
            <span class="material-symbols-outlined absolute left-4 top-1/2 -translate-y-1/2 text-primary/60 pointer-events-none select-none">search</span>
            <input
              type="text"
              id="search-input"
              placeholder="Search colors…"
              autocomplete="off"
              class="w-full pl-12 pr-10 py-3 rounded-xl border border-primary/20 bg-white dark:bg-background-dark text-[#0d121b] dark:text-white placeholder-[#0d121b]/40 dark:placeholder-white/40 focus:outline-none focus:ring-2 focus:ring-primary/30 text-sm transition-all"
            >
            <button
              id="search-clear"
              class="absolute right-4 top-1/2 -translate-y-1/2 text-primary/60 hover:text-primary hidden"
              aria-label="Clear search"
            >
              <span class="material-symbols-outlined text-xl">close</span>
            </button>
          </div>
          <!-- Dropdown — max-height 40vh on mobile so it never fills the screen -->
          <div
            id="search-dropdown"
            class="absolute top-full left-0 right-0 mt-1 bg-white dark:bg-background-dark rounded-xl border border-primary/20 shadow-xl z-50 overflow-y-auto hidden"
            style="max-height: 40vh;"
          >
            <div id="search-results" class="p-2"></div>
          </div>
        </div>
        <!-- Palette Grid -->
        <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-8" id="palette-grid"></div>
        <!-- Copied Notification (Toast) -->
        <div
          class="fixed bottom-8 left-1/2 -translate-x-1/2 z-[60] opacity-0 pointer-events-none transition-all duration-500 transform translate-y-4 max-w-[95vw] w-max"
          id="toast">
          <div
            class="flex items-center gap-4 rounded-xl border border-primary/20 bg-white dark:bg-background-dark p-4 shadow-2xl">
            <div class="bg-primary/10 text-primary p-2 rounded-lg">
              <span class="material-symbols-outlined">check_circle</span>
            </div>
            <div class="flex flex-col pr-8">
              <p class="text-[#0d121b] dark:text-white text-sm font-bold leading-tight tracking-tight">Copied to
                Clipboard</p>
              <p class="text-[#4c669a] text-xs font-normal leading-normal">The HEX code has been saved.</p>
            </div>
            <button class="text-[#4c669a] hover:text-[#0d121b]"
              onclick="this.parentElement.parentElement.classList.add('opacity-0')">
              <span class="material-symbols-outlined text-xl">close</span>
            </button>
          </div>
        </div>
      </main>
      <!-- Sophisticated Footer -->

    </div>
  </div>
  <!-- Palette Component and Interaction Logic -->
  <script>
    const paletteGrid = document.getElementById('palette-grid');
    const toast = document.getElementById('toast');
    let toastTimeoutId;
    let allSwatches = [];

    function normalizeHex(hex) {
      const normalized = (hex || '').trim().toUpperCase();
      return /^#[0-9A-F]{6}$/.test(normalized) ? normalized : null;
    }

    function escapeHtml(text) {
      return (text || '')
        .replace(/&/g, '&amp;')
        .replace(/</g, '&lt;')
        .replace(/>/g, '&gt;')
        .replace(/"/g, '&quot;')
        .replace(/'/g, '&#39;');
    }

    async function loadSwatchesFromJson() {
      try {
        const response = await fetch('./swatches.json', { cache: 'no-store' });
        if (!response.ok) {
          throw new Error(`Failed to load swatches.json (${response.status})`);
        }

        const parsed = await response.json();
        return Array.isArray(parsed) ? parsed : [];
      } catch (error) {
        console.error('Could not load swatch JSON:', error);
        return [];
      }
    }

    function renderSwatchCard(swatch) {
      const primaryHex = normalizeHex(swatch?.primary?.hex);
      if (!primaryHex) return '';

      const primaryName = swatch.primary.name || swatch.title || 'Primary';
      const secondaryColors = Array.isArray(swatch.secondary)
        ? swatch.secondary.slice(0, 5).map((color) => {
          const hex = normalizeHex(color?.hex);
          if (!hex) return null;
          return {
            name: color.name || 'Secondary',
            hex
          };
        }).filter(Boolean)
        : [];

      const secondaryMarkup = secondaryColors.length > 0
        ? `
          <div class="swatch-secondary-chips-container absolute bottom-3 left-1/2 -translate-x-1/2 z-30 flex flex-wrap gap-2 justify-center">
            ${secondaryColors.map((color) => `
              <span
                class="copy-target swatch-secondary-chip cursor-pointer"
                role="button"
                tabindex="0"
                data-hex="${escapeHtml(color.hex)}"
                data-name="${escapeHtml(color.name)}"
                aria-label="Copy ${escapeHtml(color.name)} (${escapeHtml(color.hex)})"
                style="background-color: ${escapeHtml(color.hex)};"
              ></span>
            `).join('')}
          </div>
        `
        : '';

      return `
        <article class="swatch-card group flex flex-col gap-4" id="swatch-${escapeHtml(swatch.id || '')}">
          <div
            class="copy-target swatch-primary relative w-full aspect-[4/5] rounded-xl shadow-sm transition-all duration-300 hover:shadow-xl hover:-translate-y-1 overflow-hidden cursor-pointer"
            role="button"
            tabindex="0"
            data-hex="${escapeHtml(primaryHex)}"
            data-name="${escapeHtml(primaryName)}"
            data-alt="${escapeHtml(swatch.alt || swatch.title || 'Palette swatch')}"
            aria-label="Copy ${escapeHtml(primaryName)} (${escapeHtml(primaryHex)})"
            style="background-color: ${escapeHtml(primaryHex)};"
          >
            <div class="swatch-live-label absolute top-0 inset-x-0 z-20 p-3 text-white">
              <p class="swatch-live-label-text text-xs font-semibold tracking-wide text-white/95"></p>
            </div>
            <div class="copy-overlay absolute inset-0 z-10 bg-black/12 opacity-0 transition-opacity flex items-center justify-center">
              <span class="material-symbols-outlined text-white text-4xl">content_copy</span>
            </div>
            ${secondaryMarkup}
          </div>
        </article>
      `;
    }

    function renderPalette(swatches) {
      allSwatches = swatches;
      if (!paletteGrid) return;
      paletteGrid.innerHTML = swatches
        .map((swatch) => renderSwatchCard(swatch))
        .filter(Boolean)
        .join('');
    }

    function showToast(title, body) {
      if (!toast) return;

      const titleEl = toast.querySelector('p:first-of-type');
      const bodyEl = toast.querySelector('p:last-of-type');

      if (titleEl) titleEl.textContent = title;
      if (bodyEl) bodyEl.textContent = body;

      toast.classList.remove('opacity-0', 'translate-y-4', 'pointer-events-none');
      toast.classList.add('opacity-100', 'translate-y-0');

      if (toastTimeoutId) {
        clearTimeout(toastTimeoutId);
      }

      toastTimeoutId = setTimeout(() => {
        toast.classList.add('opacity-0', 'translate-y-4', 'pointer-events-none');
        toast.classList.remove('opacity-100', 'translate-y-0');
      }, 3000);
    }

    async function copyTextToClipboard(text) {
      if (navigator.clipboard && window.isSecureContext) {
        await navigator.clipboard.writeText(text);
        return true;
      }

      const textArea = document.createElement('textarea');
      textArea.value = text;
      textArea.setAttribute('readonly', '');
      textArea.style.position = 'fixed';
      textArea.style.left = '-9999px';
      document.body.appendChild(textArea);
      textArea.focus();
      textArea.select();

      let copied = false;
      try {
        copied = document.execCommand('copy');
      } finally {
        document.body.removeChild(textArea);
      }

      if (!copied) {
        throw new Error('Copy command failed');
      }
      return true;
    }

    async function copyFromTarget(target) {
      const hex = normalizeHex(target?.dataset?.hex);
      const name = (target?.dataset?.name || 'Color').trim();
      if (!hex) return;

      try {
        await copyTextToClipboard(hex);
        showToast('Copied to Clipboard', `${name} · ${hex} copied.`);
      } catch (error) {
        showToast('Copy failed', 'Could not copy automatically.');
      }
    }

    function setCardLabel(card, text) {
      const label = card?.querySelector('.swatch-live-label');
      const labelText = card?.querySelector('.swatch-live-label-text');
      if (!label || !labelText) return;
      labelText.textContent = text;
      label.classList.add('is-visible');
    }

    function clearCardLabel(card) {
      const label = card?.querySelector('.swatch-live-label');
      if (!label) return;
      label.classList.remove('is-visible');
    }

    function getCopyTarget(node) {
      if (!paletteGrid) return null;
      const target = node?.closest?.('.copy-target');
      return target && paletteGrid.contains(target) ? target : null;
    }

    if (paletteGrid) {
      paletteGrid.addEventListener('click', async (event) => {
        const target = getCopyTarget(event.target);
        if (!target) return;
        await copyFromTarget(target);
      });

      paletteGrid.addEventListener('keydown', async (event) => {
        if (event.key !== 'Enter' && event.key !== ' ' && event.key !== 'Spacebar') {
          return;
        }

        const target = getCopyTarget(event.target);
        if (!target) return;
        event.preventDefault();
        await copyFromTarget(target);
      });

      paletteGrid.addEventListener('mouseover', (event) => {
        const target = getCopyTarget(event.target);
        if (!target) return;
        const card = target.closest('.swatch-card');
        const hex = normalizeHex(target.dataset.hex);
        const name = (target.dataset.name || 'Color').trim();
        if (!card || !hex) return;
        setCardLabel(card, `${name} · ${hex}`);
      });

      paletteGrid.addEventListener('mouseout', (event) => {
        const fromTarget = getCopyTarget(event.target);
        if (!fromTarget) return;
        const fromCard = fromTarget.closest('.swatch-card');
        if (!fromCard) return;

        const toTarget = getCopyTarget(event.relatedTarget);
        if (toTarget && toTarget.closest('.swatch-card') === fromCard) {
          return;
        }

        clearCardLabel(fromCard);
      });

      paletteGrid.addEventListener('focusin', (event) => {
        const target = getCopyTarget(event.target);
        if (!target) return;
        const card = target.closest('.swatch-card');
        const hex = normalizeHex(target.dataset.hex);
        const name = (target.dataset.name || 'Color').trim();
        if (!card || !hex) return;
        setCardLabel(card, `${name} · ${hex}`);
      });

      paletteGrid.addEventListener('focusout', (event) => {
        const fromTarget = getCopyTarget(event.target);
        if (!fromTarget) return;
        const fromCard = fromTarget.closest('.swatch-card');
        if (!fromCard) return;

        const toTarget = getCopyTarget(event.relatedTarget);
        if (toTarget && toTarget.closest('.swatch-card') === fromCard) {
          return;
        }

        clearCardLabel(fromCard);
      });
    }

    // ── Search ─────────────────────────────────────────────────────────────
    const searchInput = document.getElementById('search-input');
    const searchDropdown = document.getElementById('search-dropdown');
    const searchResults = document.getElementById('search-results');
    const searchClear = document.getElementById('search-clear');

    function matchesSwatch(swatch, q) {
      const lq = q.toLowerCase();
      if ((swatch.primary?.name || swatch.title || '').toLowerCase().includes(lq)) return true;
      if ((swatch.primary?.hex || '').toLowerCase().includes(lq)) return true;
      if ((swatch.brand || '').toLowerCase().includes(lq)) return true;
      return (swatch.secondary || []).some(c =>
        (c.name || '').toLowerCase().includes(lq) || (c.hex || '').toLowerCase().includes(lq)
      );
    }

    function renderSearchResults(results) {
      if (!searchResults) return;
      if (results.length === 0) {
        searchResults.innerHTML = '<p class="px-4 py-3 text-sm text-[#0d121b]/50 dark:text-white/50">No colors found</p>';
        return;
      }
      searchResults.innerHTML = results.map(s => {
        const hex = normalizeHex(s.primary?.hex);
        const name = s.primary?.name || s.title || 'Color';
        const brand = s.brand || '';
        if (!hex) return '';
        return `
          <button
            class="flex items-center gap-3 w-full px-4 py-2.5 hover:bg-primary/5 rounded-lg text-left transition-colors"
            data-swatch-id="${escapeHtml(s.id || '')}"
          >
            <span class="w-8 h-8 rounded-full flex-shrink-0 shadow-sm border border-black/10" style="background-color:${escapeHtml(hex)};"></span>
            <span class="flex flex-col min-w-0">
              <span class="text-sm font-medium text-[#0d121b] dark:text-white truncate">${escapeHtml(name)}</span>
              <span class="text-xs text-[#0d121b]/50 dark:text-white/50 truncate">${escapeHtml(brand)} · ${escapeHtml(hex)}</span>
            </span>
          </button>`;
      }).join('');
    }

    function openSearch(q) {
      const results = allSwatches.filter(s => matchesSwatch(s, q)).slice(0, 20);
      renderSearchResults(results);
      searchDropdown.classList.remove('hidden');
    }

    function closeSearch() {
      searchDropdown.classList.add('hidden');
    }

    if (searchInput) {
      searchInput.addEventListener('input', () => {
        const q = searchInput.value.trim();
        searchClear.classList.toggle('hidden', !q);
        q ? openSearch(q) : closeSearch();
      });

      searchInput.addEventListener('keydown', e => {
        if (e.key === 'Escape') { closeSearch(); searchInput.blur(); }
      });
    }

    if (searchClear) {
      searchClear.addEventListener('click', () => {
        searchInput.value = '';
        searchClear.classList.add('hidden');
        closeSearch();
        searchInput.focus();
      });
    }

    document.addEventListener('click', e => {
      if (!e.target.closest('#search-container')) closeSearch();
    });

    if (searchResults) {
      searchResults.addEventListener('click', e => {
        const btn = e.target.closest('[data-swatch-id]');
        if (!btn) return;
        const card = document.getElementById(`swatch-${btn.dataset.swatchId}`);
        if (card) {
          card.scrollIntoView({ behavior: 'smooth', block: 'center' });
          card.style.outline = '3px solid #a5745b';
          card.style.outlineOffset = '4px';
          card.style.borderRadius = '0.75rem';
          setTimeout(() => { card.style.outline = ''; card.style.outlineOffset = ''; }, 2000);
        }
        closeSearch();
        searchInput.value = '';
        searchClear.classList.add('hidden');
      });
    }
    // ── End Search ──────────────────────────────────────────────────────────

    loadSwatchesFromJson().then((swatches) => {
      renderPalette(swatches);

      if (swatches.length === 0) {
        showToast('Palette unavailable', 'Could not load swatch data.');
      }
    });
  </script>
</body>

</html>